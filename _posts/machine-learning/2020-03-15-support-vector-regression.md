---
layout: post
title: '支持向量回归'
date: 2020-03-15
author: 郑之杰
cover: 'https://pic.downk.cc/item/5ed759b9c2a9a83be54d254c.jpg'
tags: 机器学习
---

> Support Vector Regression.

**支持向量回归（Support Vector Regression，SVR）**是一种结合[支持向量机](https://0809zheng.github.io/2020/03/14/SVM.html)和[Tube回归](https://0809zheng.github.io/2020/03/12/regression.html#7-tube-regression)的非线性回归方法。

基本思想：
- 借鉴了支持向量机中的“支持向量”的思想，使用稀疏的样本点来决定回归函数；
- 模型从使用了$L2$正则化的$Tube$回归出发。

# 1. 原问题
若样本集$$X=\{x^{(1)},...,x^{(N)}\}$$，标签集$$y=\{y^{(1)},...,y^{(N)}\}$$，

使用了$L2$正则化的$Tube$回归的目标函数定义如下：

$$ \mathop{\min}_{w,b} \quad \frac{λ}{N}w^Tw + \frac{1}{N} \sum_{n=1}^{N} {max(0,\mid w^Tx^{(n)}+b-y^{(n)} \mid - ε)} $$

参数$ε$设置了中立区，当样本点的位置超过了回归线的中立区，才计算其损失。

借鉴支持向量机的流程，用参数$C$取代参数$λ$，平衡正则化和对损失的容忍:

$$ \mathop{\min}_{w,b} \quad \frac{1}{2}w^Tw + C \sum_{n=1}^{N} {max(0,\mid w^Tx^{(n)}+b-y^{(n)} \mid - ε)} $$

引入容忍度间隔$ξ_n$放松中立区，使得样本点都位于放松后的中立区内，将问题转化成约束优化问题：

$$ \mathop{\min}_{w,b,ξ} \quad \frac{1}{2}w^Tw + C \sum_{n=1}^{N} {ξ_n} \\ s.t. \quad \mid w^Tx^{(n)}+b-y^{(n)} \mid ≤ ε+ξ_n \\ ξ_n ≥ 0 $$

上式的约束条件是非线性的，进一步转化为线性约束：

$$ \mathop{\min}_{w,b,ξ} \quad \frac{1}{2}w^Tw + C \sum_{n=1}^{N} {ξ_n^++ξ_n^-} \\ s.t. \quad -ε-ξ_n^- ≤ w^Tx^{(n)}+b-y^{(n)} ≤ ε+ξ_n^+ \\ ξ_n^+ ≥ 0,ξ_n^- ≥ 0 $$

上式是标准的二次规划问题。其中$ξ_n^+$表示**upper tube violations**，$ξ_n^-$表示**lower tube violations**。

支持向量回归中需要设置的超参数是$C$和$ε$，求解的二次规划问题具有$2N+d+1$个变量，具有$2N+2$个约束条件。

若希望引入核方法，即使样本特征维度$d$增大，则原问题计算量大，为此引入对偶问题。

# 2. 对偶问题
引入拉格朗日乘子$α_n^-$、$α_n^+$、$β_n^-$、$β_n^+$，则拉格朗日函数：

$$ L(α,β) = \frac{1}{2}w^Tw + C \sum_{n=1}^{N} {(ξ_n^++ξ_n^-)} + \sum_{n=1}^{N} {α_n^- (-ε-ξ_n^- - w^Tx^{(n)}+b-y^{(n)})} \\ + \sum_{n=1}^{N} {α_n^+ (w^Tx^{(n)}+b-y^{(n)} - ε+ξ_n^+)} + \sum_{n=1}^{N} {-β_n^-ξ_n^-} + \sum_{n=1}^{N} {-β_n^+ξ_n^+} $$

原问题记为：

$$ \mathop{\min}_{w,b,ξ} \quad \mathop{\max}_{α,β} \quad L(α,β) \\ s.t. \quad -ε-ξ_n^- ≤ w^Tx^{(n)}+b-y^{(n)} ≤ ε+ξ_n^+ \\ ξ_n^+ ≥ 0,ξ_n^- ≥ 0 $$

转化为对偶问题：

$$ \mathop{\max}_{α,β} \quad \mathop{\min}_{w,b,ξ} \quad L(α,β) \\ s.t. \quad α_n^- ≥ 0,α_n^+ ≥ 0,β_n^- ≥ 0,β_n^+ ≥ 0 $$

由$KKT$条件：
- 原问题的约束条件：$-ε-ξ_n^- ≤ w^Tx^{(n)}+b-y^{(n)} ≤ ε+ξ_n^+ , ξ_n^+ ≥ 0,ξ_n^- ≥ 0$
- 对偶问题的约束条件：$α_n^- ≥ 0,α_n^+ ≥ 0,β_n^- ≥ 0,β_n^+ ≥ 0$
- 拉格朗日函数的梯度为零：由$\frac{\partial L(α,β)}{\partial w_i}=0$得$w=\sum_{n=1}^{N} {(α_n^+-α_n^-)x^{(n)}}$；由$\frac{\partial L(α,β)}{\partial b}=0$得$\sum_{n=1}^{N} {(α_n^+-α_n^-)}=0$
- **互补松弛条件complementary slackness**：$α_n^+ (w^Tx^{(n)}+b-y^{(n)} - ε+ξ_n^+)=0$、$α_n^- (-ε-ξ_n^- - w^Tx^{(n)}+b-y^{(n)})=0$

整理并化简，**引入核函数来代替样本的特征转换和内积运算**，记$$K_{x,x'}={φ(x)}^Tφ(x')$$，可以得到支持向量回归的对偶形式：

$$ \mathop{\min}_{α} \quad \frac{1}{2}\sum_{n=1}^{N} {\sum_{m=1}^{N} {(α_n^+-α_n^-)(α_m^+-α_m^-)K_{nm}}} + \sum_{n=1}^{N} {((ε-y^{(n)})α_n^++(ε+y^{(n)})α_n^-)} \\ s.t. \quad \sum_{n=1}^{N} {(α_n^+-α_n^-)}=0 \\ C ≥ α_n^- ≥ 0,C ≥ α_n^+ ≥ 0 $$

这也是一个二次规划问题，具有$2N$个变量，具有$2N+1$个约束条件，与样本维度$d$无关。

求解得到$α_n^-$、$α_n^+$后，原问题的解为：

$$ w=\sum_{n=1}^{N} {(α_n^+-α_n^-)x^{(n)}} $$

稀疏性的说明：
- 对于分布在中立区$\mid w^Tx^{(n)}+b-y^{(n)} \mid < ε+ξ_n$内的点，由互补松弛条件，$α_n^-=0$、$α_n^+=0$；因此这些样本点对结果没有贡献。而位于中立区之外的点，起到支持向量的作用。
