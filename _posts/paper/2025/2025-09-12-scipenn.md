---
layout: post
title: 'A multi-use deep learning method for CITE-seq and single-cell RNA-seq data integration with cell surface protein prediction and imputation'
date: 2025-09-12
author: 郑之杰
cover: 'https://pic1.imgdb.cn/item/697afa9bbb08ad63f9c733aa.png'
tags: 论文阅读
---

> 一种用于CITE-seq和单细胞RNA-seq数据整合以及细胞表面蛋白预测和插补的多用途深度学习方法.

- paper：[A multi-use deep learning method for CITE-seq and single-cell RNA-seq data integration with cell surface protein prediction and imputation](https://www.nature.com/articles/s42256-022-00545-w)

# 0. TL; DR

**sciPENN**不仅能够整合多个**CITE-seq**和**scRNA-seq**数据集，还能为**scRNA-seq**数据预测蛋白质表达、为**CITE-seq**数据插补缺失的蛋白质、量化预测和插补的不确定性、将细胞类型标签从**CITE-seq**参考迁移到**scRNA-seq**查询数据。

在多个数据集上的综合评估表明，**sciPENN**在蛋白质预测和插补的准确性上，显著优于**Seurat 4**和**totalVI**等**SOTA**方法。同时，它的计算效率比竞争对手快一个数量级，展现了卓越的可扩展性。

# 1. 背景介绍

**CITE-seq**技术允许作者同时测量同一个细胞的转录组（**RNA**）和表面蛋白（**protein**）组，为我们以更高的分辨率解析细胞异质性打开了大门。蛋白质作为细胞功能的直接执行者，其表达信息为我们理解细胞信号和相互作用提供了**RNA**层面无法替代的视角。

然而，**CITE-seq**的广泛应用也伴随着一系列新的计算挑战：
1.  成本与数据稀缺性： 生成**CITE-seq**数据的成本远高于常规的**scRNA-seq**。这导致作者通常拥有大量的**scRNA-seq**数据，但**CITE-seq**数据却相对稀少。一个自然的想法是：作者能否利用已有的**CITE-seq**数据作为参考，来为海量的**scRNA-seq**数据预测出其表面蛋白的表达谱？
2.  批次效应： 与所有单细胞技术一样，当作者需要整合来自不同实验、不同供体的多个数据集时，批次效应是一个必须解决的难题。
3.  蛋白质**panel**的不完全重叠： 这是**CITE-seq**数据整合中一个独特且棘手的挑战。不同的研究通常会使用包含不同抗体组合的蛋白质**panel**。当作者希望整合这些数据集时，如何处理那些在一个数据集中存在，而在另一个数据集中缺失的蛋白质？

现有的工具，如**Seurat 4**和**totalVI**，虽然已经开始探索这些问题，但仍存在一些局限性：**Seurat 4**无法处理蛋白质**panel**不重叠的情况；而**totalVI**虽然理论上可以，但其在该场景下的性能尚未被充分验证。此外，这两者在处理大规模数据时，都面临着计算效率的瓶颈。

为了系统性地解决这三重挑战，作者开发了**sciPENN**。它旨在通过一个统一的、高效的深度学习框架，为**CITE-seq**和**scRNA-seq**数据的整合与分析，提供一个一站式的解决方案。

# 2. sciPENN 方法

**sciPENN**的核心是一个精心设计的深度神经网络，它通过模块化的结构和审查损失函数，实现了其多功能的整合与预测能力。

![](https://pic1.imgdb.cn/item/697afc9cbb08ad63f9c73b6c.png)

## 2.1 模型架构

**sciPENN**的网络架构由一系列可重复使用的**块（blocks）**堆叠而成，主要包含一个**输入块（Input Block）**和多个**前馈块（FeedForward Block）**，并结合了一个**循环神经网络单元（RNN cell）**来整合信息流。

输入块接收一个细胞的基因表达向量 $x$ 作为输入。通过一系列全连接层、**BatchNorm**、**PReLU**激活函数和**Dropout**，对输入进行初步的特征提取和变换。

前馈块结构与输入块类似，但用于处理中间层的嵌入向量。模型中的多个前馈块串联在一起，每个块的输出都会被送入一个共享的**RNN**单元。

**RNN**单元维护一个隐藏状态，该状态会根据每个前馈块的输出进行迭代更新。最后一个前馈块更新后的最终隐藏状态，被作为该细胞的最终嵌入，用于后续的预测和数据整合可视化。

最终的嵌入被送入三个独立的全连接层，分别用于预测三个目标：
*   蛋白质均值表达 $y(x; W)$
*   蛋白质表达的分位数 $\sigma(x; W)$（用于不确定性量化）
*   细胞类型的类别概率 $p(x; W)$

## 2.2 损失函数

当作者需要整合多个蛋白质**panel**不完全相同的**CITE-seq**数据集时，作者首先将它们合并成一个大的蛋白质表达矩阵 $Y_{train}$。对于一个给定的细胞，那些在其原始数据集中未被测量的蛋白质，其表达值会被填充为0。

在计算损失函数时，**sciPENN**只考虑那些实际被测量过的蛋白质。对于一个细胞$i$和一个蛋白质$i$，如果蛋白质$i$在该细胞中被测量过，那么它的损失 $L_{ij}$ 会被正常计算并计入总损失；如果它未被测量过（即来自另一个数据集），那么它的损失贡献将被屏蔽，不参与反向传播。

$$
L_i = \frac{1}{|P_i|} \sum_{j \in P_i} L_{ij}
$$

其中，$P_i$ 是细胞$i$中被实际测量过的蛋白质集合。通过这种动态计算损失的方式，**sciPENN**能够灵活地处理每个细胞不同的有效蛋白质列表，从而实现了对多个部分重叠**CITE-seq**数据集的无缝整合。

**sciPENN**的损失函数包含两部分，分别对应蛋白质表达预测和细胞类型分类。

蛋白质表达损失 ($L_{prot}$)由两项组成：一项是预测均值与真实值之间的均方误差；另一项是**分位数损失（Quantile Loss）**，用于同时预测多个分位数，以量化预测的不确定性。

$$
L_{prot} = MSE(y, \hat{y}) + \frac{1}{k} \sum_{q \in Q} L_q(y, y_q)
$$

细胞类型损失 ($L_{type}$) 是标准的分类交叉熵损失。

$$
L_{type} = -\log(\text{Pr}(C=c_t))
$$

总损失是这两项的和 $L = L_{prot} + L_{type}$。


# 3. 实验分析

作者通过五个精心设计的应用场景，对**sciPENN**的各项功能进行了全面的评估，并与**Seurat 4**和**totalVI**进行了比较。

## 3.1 实验一：PBMC参考集到MALT查询集的预测

这是一个跨数据集预测任务，参考集（**PBMC**）和查询集（**MALT**）在细胞类型、测序深度等方面都存在巨大差异。
- 图a (数据整合): 尽管存在巨大差异，**sciPENN**在整合两个数据集方面表现最好，实现了部分混合。
- 图b (预测精度): **sciPENN**在蛋白质预测准确性上全面领先，无论是在皮尔逊相关性还是均方根误差上都取得了最佳性能。
- 图c (不确定性量化): **sciPENN**的预测区间覆盖率远优于**totalVI**。例如，其名义80%的预测区间，实际覆盖率达到了44.6%，而**totalVI**仅为18.3%。
- 图d (**Marker**蛋白恢复): **sciPENN**能最准确地恢复**marker**蛋白（如**CD8a**）的表达模式，而**totalVI**和**Seurat 4**则出现了不同程度的错误预测。

![](https://pic1.imgdb.cn/item/697b085ebb08ad63f9c73fa4.png)

## 3.2 实验二：单核细胞数据集内的预测

作者在一个自己生成的、包含8个样本的单核细胞**CITE-seq**数据集上，进行了数据集内（4个样本训练，4个样本测试）的预测。
- 图a (数据整合): **sciPENN**实现了对训练集和测试集的完美混合。
- 图b (预测精度): 在**RMSE**指标上，**sciPENN**再次领先。
- 图c (不确定性量化): **sciPENN**的80%预测区间实现了**71.7%**的覆盖率，表现合理；而**totalVI**仅为21.2%，其不确定性估计存在严重偏差。
- 图d (**Marker**蛋白恢复): 所有三种方法都能较好地恢复**CD14**, **CD16**等关键**marker**的表达模式。

![](https://pic1.imgdb.cn/item/697b088fbb08ad63f9c73fbc.png)

## 3.3 实验三：PBMC数据集内的预测与标签迁移

作者在一个大规模的**PBMC**数据集内进行了一半训练、一半测试的实验。
- 图a (**Marker**蛋白趋势恢复): **sciPENN**最准确地恢复了**CD8** T细胞亚群的**marker**蛋白（如**CD45RA**, **CD44-2**）的表达趋势。
- 图b (标签迁移): 在将细胞类型标签从训练集迁移到测试集的任务中，**sciPENN**的准确率达到了**83.9%**，显著高于**Seurat 4**的**78.5%**。
- 图c (刺激响应生物标志物恢复): 作者进一步测试了恢复疫苗刺激后**CD169**蛋白表达动态变化的能力。**sciPENN**清晰地重现了**CD169**在接种后第3天表达量达到峰值的模式，其统计显著性远高于其他两种方法。

![](https://pic1.imgdb.cn/item/697b08c2bb08ad63f9c73fe1.png)

## 3.4 实验四：PBMC参考集到H1N1流感数据集的预测

这是一个中等难度的跨数据集预测任务。
- 图a (数据整合): **sciPENN**和**totalVI**都能较好地混合两个数据集，而**Seurat 4**效果不佳。
- 图b (预测精度): **sciPENN**和**totalVI**的预测相关性相当，但**sciPENN**的**RMSE**更低。
- 图c (不确定性量化): **sciPENN**再次在不确定性量化上展现了巨大优势，其80%预测区间的覆盖率（63.7%）远高于**totalVI**（11.1%）。

![](https://pic1.imgdb.cn/item/697b08ecbb08ad63f9c73fe3.png)

## 3.5 实验五：整合两个部分重叠的COVID-19数据集

这是对**sciPENN**核心功能（处理部分重叠**panel**）的最直接验证。作者整合了两个总计近90万细胞的**COVID-19** **CITE-seq**数据集，它们共享110种蛋白质，但各自有约37种独有的蛋白质。
- 图a (数据整合): **sciPENN**高效地将两个大规模数据集整合到了一个共同的嵌入空间中，并实现了良好的混合。而**totalVI**则完全失败。
- 图b (蛋白质插补精度): **sciPENN**能够为每个数据集插补其缺失的蛋白质。在两个方向的插补任务中，其准确性（相关性和**RMSE**）都显著优于**totalVI**。
- 图c (插补结果可视化): **Feature plot**直观地显示，**sciPENN**插补的蛋白表达模式与真实模式高度吻合。

![](https://pic1.imgdb.cn/item/697b0927bb08ad63f9c74fdc.png)