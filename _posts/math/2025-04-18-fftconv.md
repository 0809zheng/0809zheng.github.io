---
layout: post
title: 'ä½¿ç”¨å¿«é€Ÿå‚…é‡Œå¶å˜æ¢(FFT)åŠ é€Ÿå·ç§¯è¿ç®—'
date: 2025-04-18
author: éƒ‘ä¹‹æ°
cover: ''
tags: æ•°å­¦
---

> Using Fast Fourier Transform (FFT) to Speed Up Convolution Operations.

æœ¬æ–‡ç›®å½•ï¼š
1. å·ç§¯è¿ç®— **Convolution**
2. å‚…é‡Œå¶å˜æ¢ **Fourier Transform**
3. ä½¿ç”¨**FFT**åŠ é€Ÿæ·±åº¦å­¦ä¹ ä¸­çš„å·ç§¯è¿ç®—

# 1. å·ç§¯è¿ç®— Convolution

## ï¼ˆ1ï¼‰è¿ç»­å½¢å¼çš„å·ç§¯

**å·ç§¯ (Convolution)** è¿ç®—æ˜¯ä¸€ç§é€šè¿‡ä¸¤ä¸ªå‡½æ•°$\displaystyle f$å’Œ$\displaystyle g$ç”Ÿæˆç¬¬ä¸‰ä¸ªå‡½æ•°çš„æ•°å­¦ç®—å­ï¼Œå®šä¹‰ä¸ºï¼š

$$
(f*g)(t)=\int_{-\infty}^{\infty}f(\tau)g(t-\tau)d\tau
$$

![](https://pic1.imgdb.cn/item/6801e0f588c538a9b5dada20.png)

å·ç§¯è¡¨å¾å‡½æ•°$\displaystyle f$ä¸ç»è¿‡ç¿»è½¬å’Œå¹³ç§»çš„$\displaystyle g$çš„ä¹˜ç§¯å‡½æ•°æ‰€å›´æˆçš„æ›²è¾¹æ¢¯å½¢çš„é¢ç§¯ã€‚å¦‚æœå°†å‚åŠ å·ç§¯çš„ä¸€ä¸ªå‡½æ•°çœ‹ä½œåŒºé—´çš„æŒ‡ç¤ºå‡½æ•°ï¼Œå·ç§¯å¯ä»¥è¢«çœ‹ä½œæ˜¯â€œç§»åŠ¨å¹³å‡â€çš„æ¨å¹¿ã€‚

![](https://upload.wikimedia.org/wikipedia/commons/6/6a/Convolution_of_box_signal_with_itself2.gif)

### âšª è®¨è®ºï¼šå·ç§¯ä¸äº’ç›¸å…³

**äº’ç›¸å…³ (Cross-Correlation)** è¿ç®—ä¹Ÿæ˜¯ä¸€ç§é€šè¿‡ä¸¤ä¸ªå‡½æ•°$\displaystyle f$å’Œ$\displaystyle g$ç”Ÿæˆç¬¬ä¸‰ä¸ªå‡½æ•°çš„æ•°å­¦ç®—å­å®šä¹‰ä¸ºï¼š

$$
(f\circledast g)(t)=\int_{-\infty}^{\infty}\overline{f(\tau-t)}g(\tau)d\tau
$$

å‡½æ•°$\displaystyle f(t)$å’Œ$\displaystyle g(t)$çš„äº’ç›¸å…³ç­‰ä»·äºå‡½æ•°$\displaystyle f(-t)$çš„å…±è½­å¤æ•°å’Œ$\displaystyle g(t)$çš„å·ç§¯ï¼š

$$
(f\circledast g)(t) = \overline{\displaystyle f(-t)} * g(t)
$$

![](https://pic1.imgdb.cn/item/6801e4b488c538a9b5dae98b.png)

åœ¨å®æ•°åŸŸä¸­ï¼Œå·ç§¯å’Œäº’ç›¸å…³çš„ä¸»è¦åŒºåˆ«æ˜¯å·ç§¯å…·æœ‰å¯¹å…¶ä¸­ä¸€ä¸ªå‡½æ•°çš„**ç¿»è½¬**æ“ä½œï¼Œè¯¥æ“ä½œä¿è¯äº†å·ç§¯æ»¡è¶³**äº¤æ¢å¾‹**ï¼š

$$
\begin{aligned}
(f*g)(t)&=\int_{-\infty}^{\infty}f(\tau)g(t-\tau)d\tau \\
(\text{let} &\quad x=t-\tau)\\
&=-\int_{\infty}^{-\infty}f(t-x)g(x)dx \\
&=\int_{-\infty}^{\infty}g(\tau)f(t-\tau)d\tau =(g*f)(t)
\end{aligned}
$$

åœ¨[å·ç§¯ç¥ç»ç½‘ç»œ](https://0809zheng.github.io/2020/03/06/CNN.html)ä¸­ï¼Œå·ç§¯å®é™…æŒ‡çš„æ˜¯äº’ç›¸å…³æ“ä½œã€‚ä¸€æ–¹é¢ï¼Œå·ç§¯ç¥ç»ç½‘ç»œçš„æ“ä½œæ˜¯ä½¿ç”¨å‡½æ•°$\displaystyle g(t)$ï¼ˆç§°ä¸ºå·ç§¯æ ¸ï¼‰å¯¹$\displaystyle f(t)$ï¼ˆç§°ä¸ºè¾“å…¥ç‰¹å¾ï¼‰è¿›è¡Œâ€œå·ç§¯â€ï¼Œå› æ­¤äº¤æ¢å¾‹æ˜¯ä¸å¿…è¦çš„ï¼›å¦ä¸€æ–¹é¢ï¼Œå·ç§¯ç¥ç»ç½‘ç»œçš„å·ç§¯æ ¸å‚æ•°æ˜¯å¯å­¦ä¹ çš„ï¼Œ(å¦‚æœéœ€è¦)ä¹Ÿå¯ä»¥å­¦ä¹ åˆ°ç¿»è½¬çš„å‚æ•°ï¼Œæ²¡æœ‰å¿…è¦æ˜¾å¼åœ°è¿›è¡Œç¿»è½¬ã€‚

## ï¼ˆ2ï¼‰ç¦»æ•£å½¢å¼çš„å·ç§¯

### a. çº¿æ€§å·ç§¯ Linear Convolution

çº¿æ€§å·ç§¯å‚ä¸è¿ç®—çš„æ˜¯ä¸¤ä¸ªæœ‰é™é•¿åº¦çš„éå‘¨æœŸåºåˆ—ã€‚å¯¹äºé•¿åº¦ä¸º$M$çš„åºåˆ—$x$å’Œé•¿åº¦ä¸º$N$çš„åºåˆ—$h$ï¼Œçº¿æ€§å·ç§¯çš„è¾“å‡ºåºåˆ—$y$çš„é•¿åº¦ä¸º$M+N-1$ï¼Œå®šä¹‰ä¸ºï¼š

$$
y[n] = \sum_{k=-\infty}^{\infty}x[k]\cdot h[n-k]
$$

### b. å¾ªç¯å·ç§¯ Circular Convolution

å¾ªç¯å·ç§¯ä¹Ÿå«åœ†å‘¨å·ç§¯ï¼Œå‚ä¸è¿ç®—çš„åºåˆ—$h$æ˜¯å‘¨æœŸåºåˆ—ï¼ˆåºåˆ—$x$é€šå¸¸æ˜¯æœ‰é™çš„éå‘¨æœŸåºåˆ—ï¼Œå³å·ç§¯æ ¸ï¼‰ã€‚

è®¡ç®—å¾ªç¯å·ç§¯æ—¶éœ€è¦å…ˆç»™å®šä¸€ä¸ªå‘¨æœŸ$T$ï¼ˆé€šå¸¸æ˜¯åºåˆ—$h$çš„å‘¨æœŸï¼‰ï¼Œç„¶åå°†ä¸¤ä¸ªä¿¡å·çš„é•¿åº¦éƒ½æ‰©å±•ä¸º$T$ï¼Œè¿›è¡Œå·ç§¯è¿ç®—åå–å‡ºä¸»å€¼åŒºé—´ï¼ˆå³åŒºé—´$[0,T]$ï¼‰çš„ç»“æœï¼›

$$
y[n] = \sum_{k=0}^{T-1}x[k]\cdot h_T[n-k] R_T[n]
$$

å…¶ä¸­$R_T[n]$æ˜¯å‘¨æœŸä¸º$T$çš„çŸ©å½¢åºåˆ—ã€‚å¾ªç¯å·ç§¯çš„è¾“å‡ºé•¿åº¦ä¸ºå‘¨æœŸ$T$ã€‚

### âšª è®¨è®ºï¼šçº¿æ€§å·ç§¯ä¸å¾ªç¯å·ç§¯çš„å…³ç³»

å¾ªç¯å·ç§¯å¯ä»¥çœ‹ä½œçº¿æ€§å·ç§¯ä»¥$T$ä¸ºå‘¨æœŸè¿›è¡Œå‘¨æœŸå»¶æ‹“åå–ä¸»å€¼åŒºé—´çš„ç»“æœã€‚è¯æ˜å¦‚ä¸‹ï¼š

$$
\begin{aligned}
y_{\text{CircularConv}}[n] &= \sum_{k=0}^{T-1}x[k]\cdot h_T[n-k] R_T[n] \\
&= \sum_{k=0}^{T-1}x[k]\cdot \sum_{r=-\infty}^{\infty}h[n+rT-k] R_T[n] \\
&= \sum_{r=-\infty}^{\infty}\left(\sum_{k=0}^{T-1}x[k]\cdot h[n+rT-k]\right) R_T[n] \\
&= \sum_{r=-\infty}^{\infty}y_{\text{LinearConv}}[n+rT] R_T[n] \\
\end{aligned}
$$

çº¿æ€§å·ç§¯ä¸å¾ªç¯å·ç§¯çš„å¯è§†åŒ–å¦‚ä¸‹ï¼š

![](https://pic1.imgdb.cn/item/6801f02c88c538a9b5db0abd.png)

æ³¨æ„åˆ°åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œçº¿æ€§å·ç§¯ä¸å¾ªç¯å·ç§¯çš„ç»“æœä¸åŒã€‚è¿™æ˜¯å› ä¸ºè¦è®©ä¸¤ä¸ªæœ‰é™é•¿åº¦çš„éå‘¨æœŸåºåˆ—çš„çº¿æ€§å·ç§¯ä¸å¾ªç¯å·ç§¯è®¡ç®—ç»“æœä¸€è‡´ï¼Œåˆ™å¾ªç¯å·ç§¯çš„å»¶æ‹“å‘¨æœŸ$T$ä¸ä¸¤ä¸ªåºåˆ—çš„é•¿åº¦$M,N$éœ€æ»¡è¶³å…³ç³»ï¼š

$$
T \geq M+N-1
$$

è‹¥ä¸æ»¡è¶³ä¸Šè¿°å…³ç³»ï¼Œçº¿æ€§å·ç§¯åœ¨åšå‘¨æœŸå»¶æ‹“æ—¶ä¼šæœ‰æ—¶åŸŸä¸Šçš„**æ··å **ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾åºåˆ—$x$å’Œåºåˆ—$h$çš„é•¿åº¦éƒ½ä¸º$2$ï¼Œä»¥å‘¨æœŸ$T=2$è¿›è¡Œå‘¨æœŸå»¶æ‹“ï¼Œåˆ™çº¿æ€§å·ç§¯å’Œå¾ªç¯å·ç§¯çš„ç»“æœå¦‚ä¸‹ï¼š

![](https://pic1.imgdb.cn/item/6801f82588c538a9b5db2771.png)

ç»“æœè¡¨æ˜ï¼Œåœ¨åšå¾ªç¯å·ç§¯çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæœ‰æ•ˆè¾“å‡ºæ—¶ï¼Œåˆ†åˆ«æœ‰ä¸Šä¸€å‘¨æœŸå’Œä¸‹ä¸€å‘¨æœŸçš„åºåˆ—å‚ä¸äº†è¿ç®—ï¼Œå¯¼è‡´äº†æ—¶åŸŸä¸Šçš„æ··å ã€‚

è‹¥ä»¥å‘¨æœŸ$T=3$è¿›è¡Œå‘¨æœŸå»¶æ‹“ï¼ˆé€šè¿‡åœ¨åºåˆ—ç»“å°¾**padding**é€‚å½“çš„$0$å®ç°ï¼‰ï¼Œåˆ™çº¿æ€§å·ç§¯å’Œå¾ªç¯å·ç§¯çš„ç»“æœå¦‚ä¸‹ï¼š

![](https://pic1.imgdb.cn/item/6801fa2f88c538a9b5db2ef6.png)

æ­¤æ—¶ï¼Œçº¿æ€§å·ç§¯å’Œå¾ªç¯å·ç§¯çš„æœ‰æ•ˆç»“æœä¸€è‡´ï¼ˆè¾“å‡ºéœ€è¦ä¸¢å¼ƒå°¾éƒ¨çš„**padding**éƒ¨åˆ†ï¼‰ã€‚


# 2. å‚…é‡Œå¶å˜æ¢ Fourier Transform

**å‚…é‡Œå¶å˜æ¢ï¼ˆFourier transform, FTï¼‰**æ˜¯ä¸€ç§çº¿æ€§å˜æ¢ï¼Œé€šå¸¸å®šä¹‰ä¸ºä¸€ç§ç§¯åˆ†å˜æ¢ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯ä¸€ä¸ªå‡½æ•°å¯ä»¥ç”¨æ— ç©·å¤šä¸ªå‘¨æœŸå‡½æ•°çš„çº¿æ€§ç»„åˆæ¥é€¼è¿‘ã€‚è¿™äº›ç»„åˆç³»æ•°åœ¨ä¿æœ‰åŸå‡½æ•°çš„å‡ ä¹å…¨éƒ¨ä¿¡æ¯çš„åŒæ—¶ï¼Œè¿˜ç›´æ¥åœ°åæ˜ äº†è¯¥å‡½æ•°çš„â€œé¢‘åŸŸç‰¹å¾â€ã€‚

![](https://upload.wikimedia.org/wikipedia/commons/7/72/Fourier_transform_time_and_frequency_domains_%28small%29.gif)

## ï¼ˆ1ï¼‰å‚…é‡Œå¶å˜æ¢çš„å½¢å¼

å‚…é‡Œå¶å˜æ¢å®ç°äº†æ—¶åŸŸå‡½æ•°$f(x)$ä¸é¢‘åŸŸå‡½æ•°$\hat{f}(k)$ä¹‹é—´çš„è½¬æ¢ã€‚å…¶å½¢å¼åŒ…æ‹¬ï¼š

![](https://pic1.imgdb.cn/item/6801fc8488c538a9b5db3a49.png)

å‡½æ•°åœ¨æ—¶ï¼ˆé¢‘ï¼‰åŸŸçš„ç¦»æ•£å¯¹åº”äºå…¶åƒå‡½æ•°åœ¨é¢‘ï¼ˆæ—¶ï¼‰åŸŸçš„å‘¨æœŸæ€§ã€‚åä¹‹è¿ç»­åˆ™å¯¹åº”äºå…¶åƒå‡½æ•°çš„éå‘¨æœŸæ€§ã€‚

### âšª è¿ç»­å‚…é‡Œå¶å˜æ¢

**è¿ç»­å‚…é‡Œå¶å˜æ¢**æŠŠæ—¶åŸŸçš„è¿ç»­ã€éå‘¨æœŸæ€§å‡½æ•°è½¬æ¢æˆé¢‘åŸŸçš„è¿ç»­ã€éå‘¨æœŸæ€§å‡½æ•°ï¼š

$$
\mathcal{F}(f)(k) = \hat{f}(k) = \int_{-\infty}^{\infty} f(x) e^{-2\pi i k x} dx \\
\mathcal{F}^{-1}(\hat{f})(x) = f(x) = \int_{-\infty}^{\infty} \hat{f}(k) e^{2\pi i x k} dk
$$


### âšª å‚…é‡Œå¶çº§æ•°ï¼ˆFourier seriesï¼‰

**å‚…é‡Œå¶çº§æ•°**æŠŠæ—¶åŸŸçš„è¿ç»­ã€å‘¨æœŸæ€§å‡½æ•°è½¬æ¢æˆé¢‘åŸŸçš„ç¦»æ•£ã€éå‘¨æœŸæ€§å‡½æ•°ï¼š

$$
\begin{aligned}
f(x) &\sim A_0 + \sum_{n=1}^\infty \left( A_n\cos \left(\frac{2\pi n x}{T}\right) + B_n\sin \left(\frac{2\pi n x}{T}\right)\right) \\
A_0 &= \frac{1}{T} \int_{-T/2}^{T/2} f(x) dx \\
A_n &= \frac{2}{T} \int_{-T/2}^{T/2} f(x) \cos \left(\frac{2\pi n x}{T}\right) dx \\
B_n &= \frac{2}{T} \int_{-T/2}^{T/2} f(x) \sin \left(\frac{2\pi n x}{T}\right) dx
\end{aligned}
$$

### âšª ç¦»æ•£æ—¶é—´å‚…é‡Œå¶å˜æ¢ï¼ˆDTFTï¼‰

**ç¦»æ•£æ—¶é—´å‚…é‡Œå¶å˜æ¢**æŠŠæ—¶åŸŸçš„ç¦»æ•£ã€éå‘¨æœŸæ€§å‡½æ•°è½¬æ¢æˆé¢‘åŸŸçš„è¿ç»­ã€å‘¨æœŸæ€§å‡½æ•°ï¼š

$$
\mathcal{F}(f)[k] = \hat{f}[k] = \sum_{x=-\infty}^{\infty} f[x] e^{- i k x}
$$

**DTFT**å¯ä»¥è¢«çœ‹ä½œæ˜¯å‚…é‡Œå¶çº§æ•°çš„é€†å˜æ¢ã€‚

### âšª ç¦»æ•£å‚…é‡Œå¶å˜æ¢ï¼ˆDFTï¼‰

**ç¦»æ•£å‚…é‡Œå¶å˜æ¢**æŠŠæ—¶åŸŸçš„ç¦»æ•£ã€å‘¨æœŸæ€§å‡½æ•°è½¬æ¢æˆé¢‘åŸŸçš„ç¦»æ•£ã€å‘¨æœŸæ€§å‡½æ•°ï¼š

$$
\mathcal{F}(f)[k] = \hat{f}[k] = \sum_{x=0}^{T-1} f[x] e^{-\frac{2\pi i k x}{T}}, \quad k=0,1,...,T-1 \\
\mathcal{F}^{-1}(\hat{f})[x] = f[x] =\frac{1}{T} \int_{k=0}^{T-1} \hat{f}[k] e^{\frac{2\pi i x k}{T}} , \quad x=0,1,...,T-1
$$

åœ¨é¢‘åŸŸä¸Šï¼Œ**DFT**çš„ç¦»æ•£è°±æ˜¯å¯¹**DTFT**è¿ç»­è°±çš„ç­‰é—´éš”é‡‡æ ·ã€‚

## ï¼ˆ2ï¼‰å·ç§¯å®šç†

å·ç§¯å®šç†æŒ‡å‡ºï¼Œåœ¨é€‚å½“çš„æ¡ä»¶ä¸‹ï¼Œå‡½æ•°å·ç§¯ï¼ˆä¹˜ç§¯ï¼‰çš„å‚…é‡Œå¶å˜æ¢æ˜¯å‡½æ•°å‚…é‡Œå¶å˜æ¢çš„ä¹˜ç§¯ï¼ˆå·ç§¯ï¼‰ã€‚å³ä¸€ä¸ªåŸŸä¸­çš„å·ç§¯å¯¹åº”äºå¦ä¸€ä¸ªåŸŸä¸­çš„ä¹˜ç§¯ï¼š

$$
\mathcal{F}(f * g) = \mathcal{F}(f) \cdot \mathcal{F}(g) \\
\mathcal{F}(f \cdot  g) = \mathcal{F}(f) *\mathcal{F}(g)
$$

ä»¥è¿ç»­å‚…é‡Œå¶å˜æ¢ä¸ºä¾‹ï¼Œè¯æ˜å¦‚ä¸‹ï¼š

$$
\begin{aligned}
\mathcal{F}(f * g) &= \int_{-\infty}^{\infty} (f*g)(x) e^{-2\pi i k x} dx \\
&= \int_{-\infty}^{\infty} \int_{-\infty}^{\infty}f(\tau)g(x-\tau)e^{-2\pi i k x} d\tau dx \\
(\text{let} \quad & y = x - \tau) \\
&= \int_{-\infty}^{\infty} \int_{-\infty}^{\infty}f(\tau)g(y)e^{-2\pi i k (y+\tau)} d\tau dy \\
&= \left[\int_{-\infty}^{\infty}f(\tau)e^{-2\pi i k \tau} d\tau\right] \left[ \int_{-\infty}^{\infty}g(y)e^{-2\pi i k y}  dy \right] \\
&= \mathcal{F}(f) \cdot \mathcal{F}(g)
\end{aligned}
$$

## ï¼ˆ3ï¼‰å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ Fast Fourier Transform

**å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ (FFT)** æ˜¯è®¡ç®—**DFT**çš„é«˜æ•ˆã€å¿«é€Ÿæ–¹æ³•ï¼Œé‡‡ç”¨è¿™ç§ç®—æ³•èƒ½ä½¿è®¡ç®—æœºè®¡ç®—**DFT**æ‰€éœ€è¦çš„ä¹˜æ³•æ¬¡æ•°å¤§å¤§å‡å°‘ï¼Œä»è€ŒæŠŠ**DFT**çš„$\mathcal{O}(n^2)$è®¡ç®—å¤æ‚åº¦é™ä½ä¸º$\mathcal{O}(n \log n)$ã€‚

### âšª Cooley-Tukeyç®—æ³•

å‡è®¾$T$æ˜¯$2$çš„æ•´æ•°å¹‚ï¼ŒæŠŠ**DFT**æŒ‰ç…§æ—¶åŸŸçš„å¥‡æ•°ç‚¹å’Œå¶æ•°ç‚¹è¿›è¡Œæ‹†åˆ†ï¼š

$$
\begin{aligned}
\hat{f}[k] &= \sum_{x=0}^{T-1} f[x] e^{-\frac{2\pi i k x}{T}} \\
&= \sum_{n=0}^{T/2-1} f[2n] e^{-\frac{2\pi i k (2n)}{T}} + \sum_{x=0}^{T/2-1} f[2n+1] e^{-\frac{2\pi i k (2n+1)}{T}} \\
&= \sum_{n=0}^{T/2-1} f[2n] e^{-\frac{2\pi i k (2n)}{T}} + e^{-\frac{2\pi i k }{T}}\sum_{x=0}^{T/2-1} f[2n+1] e^{-\frac{2\pi i k (2n)}{T}} \\
(\text{let} \quad & W_T = e^{-\frac{2\pi i}{T}}) \\
&= \sum_{n=0}^{T/2-1} f[2n] W_T^{2k} + W_T^k\sum_{x=0}^{T/2-1} f[2n+1] W_T^{2k} \\
(\text{let} \quad & A_1(x)= \sum_{n=0}^{T/2-1} f[2n] x, \quad A_2(x)= \sum_{n=0}^{T/2-1} f[2n+1] x) \\
&= A_1(W_T^{2k}) + W_T^kA_2(W_T^{2k}), \quad k=0,1,...,T-1 \\
\end{aligned}
$$

å¹¶ä¸”æ³¨æ„åˆ°ï¼š

$$
\begin{aligned}
&W_T^{2k}= e^{-\frac{2\pi i(2k)}{T}}= e^{-\frac{2\pi ik}{T/2}} = W_{\frac{T}{2}}^k \\
&W_T^{k+\frac{T}{2}}= e^{-\frac{2\pi i(k+\frac{T}{2})}{T}}= e^{-\frac{2\pi ik}{T}}\cdot e^{\pi i} = -W_T^k \\
&W_T^T= e^{-\frac{2\pi iT}{T}}= e^{-2\pi i} = 1 \\
\end{aligned}
$$

ä¸‹é¢åˆ†æƒ…å†µè®¨è®ºã€‚

- å½“$k=0,1,...,\frac{T}{2}-1$æ—¶ï¼Œæœ‰ï¼š

$$
\begin{aligned}
\hat{f}[k]&= A_1(W_T^{2k}) + W_T^kA_2(W_T^{2k}) \\
&= A_1(W_{\frac{T}{2}}^k) + W_T^kA_2(W_{\frac{T}{2}}^k) \\
\end{aligned}
$$

- å½“$k=\frac{T}{2},\frac{T}{2}+1,...,T-1$æ—¶ï¼Œå¯ä»¥ç­‰ä»·åœ°æ›¿æ¢ä¸º$k+\frac{T}{2}(k=0,1,...,\frac{T}{2}-1)$ï¼š

$$
\begin{aligned}
\hat{f}[k]&= A_1(W_T^{2k}) + W_T^kA_2(W_T^{2k}) \\
&= A_1(W_T^{2(k+\frac{T}{2})}) + W_T^{k+\frac{T}{2}}A_2(W_T^{2(k+\frac{T}{2})}) \\
&= A_1(W_T^{2k}W_T^T) + W_T^{k+\frac{T}{2}}A_2(W_T^{2k}W_T^T)\\
&= A_1(W_{\frac{T}{2}}^k) -W_T^kA_2(W_{\frac{T}{2}}^k)\\
\end{aligned}
$$

å› æ­¤å¦‚æœèƒ½å¤Ÿæ±‚å‡º$A_1(W_{\frac{T}{2}}^k)$å’Œ$A_2(W_{\frac{T}{2}}^k)$ï¼Œåˆ™å¯ä»¥$O(1)$çš„æ—¶é—´å¤æ‚åº¦æ±‚å‡º$\hat{f}[k]$ã€‚è€Œæ±‚$A_1(W_{\frac{T}{2}}^k)$å’Œ$A_2(W_{\frac{T}{2}}^k)$åˆå¯ä»¥é€’å½’åœ°è½¬æ¢ä¸ºæ±‚$A_{11}(W_{\frac{T}{4}}^k),A_{12}(W_{\frac{T}{4}}^k)$å’Œ$A_{21}(W_{\frac{T}{4}}^k),A_{22}(W_{\frac{T}{4}}^k)$ã€‚é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ä¸ºï¼š

$$
A_{\cdots}(W^k_1) = e^{-2\pi i} = 1
$$

### âšª è¶å½¢è¿ç®—

ä¸‹é¢ä»¥ä¸€ä¸ªé•¿åº¦ä¸º$N=8$çš„åºåˆ—$x[0],x[1],...,x[7]$ä¸ºä¾‹ï¼Œè¯´æ˜**FFT**è¿ç®—çš„è¿‡ç¨‹ã€‚

å‡è®¾å·²ç»æ±‚å‡ºäº†$A_1(W_{\frac{T}{2}}^k)$ï¼ˆå³ä½¿ç”¨$x[0],x[2],x[4],x[6]$æ±‚å‡ºäº†$G[0],G[1],G[2],G[3]$ï¼‰å’Œ$A_2(W_{\frac{T}{2}}^k)$ï¼ˆå³ä½¿ç”¨$x[1],x[3],x[5],x[7]$æ±‚å‡ºäº†$H[0],H[1],H[2],H[3]$ï¼‰ã€‚åˆ™æœ€ç»ˆç»“æœè®¡ç®—ä¸ºï¼š

$$
\begin{aligned}
X[k]&= 
\begin{cases}
G[k] + W_N^kH[k], & k=0,1,2,3 \\
G[k] - W_N^kH[k], & k=4,5,6,7
\end{cases}
\end{aligned}
$$

![](https://pic1.imgdb.cn/item/6804852658cb8da5c8b85de8.png)

ä¸Šå›¾ä¸­çº¢æ¡†éƒ¨åˆ†ï¼ˆå³è®¡ç®—$A_1(W_{\frac{T}{2}}^k)$ï¼‰åˆå¯ä»¥é€’å½’åœ°è®¡ç®—ä¸ºï¼ˆç›¸å½“äºè®¡ç®—$A_1(W_{\frac{T}{4}}^k),A_2(W_{\frac{T}{4}}^k)$ï¼‰ï¼š

![](https://pic1.imgdb.cn/item/680485c358cb8da5c8b86009.png)

ä¸Šå›¾ä¸­çº¢æ¡†éƒ¨åˆ†ï¼ˆå³è®¡ç®—$A_1(W_{\frac{T}{4}}^k)$æ»¡è¶³é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ï¼š

![](https://pic1.imgdb.cn/item/680486a158cb8da5c8b86297.png)

è¯¥åºåˆ—å®Œæ•´çš„**FFT**è¿ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š

![](https://pic1.imgdb.cn/item/6804870758cb8da5c8b86352.png)

ç”±äºæ¯ä¸€ä¸ªé€’å½’å•å…ƒä¸­çš„æ•°æ®è¿æ¥å…³ç³»åƒä¸€ä¸ªè´è¶ğŸ¦‹ï¼Œå› æ­¤**FFT**è¿ç®—ä¹Ÿè¢«ç§°ä½œâ€œè¶å½¢è¿ç®—â€ã€‚

ä¸€ä¸ªé•¿åº¦ä¸º$N$çš„**FFT**éœ€è¦ $\frac{N}{2} \log_2 N$ æ¬¡å¤æ•°ä¹˜æ³•ï¼ˆæ¯ä¸ªå¤æ•°ä¹˜æ³•å¯¹åº”$4$æ¬¡å®æ•°ä¹˜æ³•ï¼‰å’Œ $N \log_2 N$ æ¬¡å¤æ•°åŠ æ³•ï¼ˆæ¯ä¸ªå¤æ•°åŠ æ³•å¯¹åº”$2$æ¬¡å®æ•°åŠ æ³•ï¼‰ã€‚å› æ­¤ï¼š
- ä¸€æ¬¡**FFT**çš„å®æ•°ä¹˜æ³•ï¼š$2 M \log_2 M$
- ä¸€æ¬¡**FFT**çš„å®æ•°åŠ æ³•ï¼š$2 M \log_2 M$

### âšª iFFT

**FFT**ç®—æ³•çš„é€†è¿ç®—å³ç¦»æ•£å‚…é‡Œå¶é€†å˜æ¢ï¼ˆ**IDFT**ï¼‰ã€‚å¯¹äº**DFT**ï¼š

$$
\begin{aligned}
\hat{f}[k] &= \sum_{x=0}^{T-1} f[x] W_T^{kx} \\
 W_T &= e^{-\frac{2\pi i}{T}}
\end{aligned}
$$

å¦‚æœç”¨çŸ©é˜µå°è£…ä¸Šè¿°è¿‡ç¨‹ï¼Œåˆ™å¯ä»¥è¡¨ç¤ºä¸ºï¼š

$$
\begin{bmatrix}
1 & 1 & 1 & \cdots & 1 \\
1 & W_T & W_T^2 & \cdots & W_T^{T-1} \\
1 & W_T^2 & W_T^4 & \cdots & W_T^{2(T-1)} \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
1 & W_T^{T-1} & W_T^{2(T-1)} & \cdots & W_T^{(T-1)^2} \\
\end{bmatrix}
\begin{bmatrix}
f[0] \\
f[1] \\
f[2] \\
\vdots \\
f[T-1] \\
\end{bmatrix}
=
\begin{bmatrix}
\hat{f}[0] \\
\hat{f}[1] \\
\hat{f}[2] \\
\vdots \\
\hat{f}[T-1] \\
\end{bmatrix} \\
\downarrow \\
WF=\hat{F}
$$

**IDFT**å³å¯»æ‰¾ä¸€ä¸ªçŸ©é˜µ$W^{-1}$ï¼Œä»è€Œæ±‚è§£ï¼š

$$
F=W^{-1}\hat{F}
$$

æ³¨æ„åˆ°ï¼š

$$
\begin{aligned}
&\begin{bmatrix}
1 & W_T^k & W_T^{2k} & \cdots & W_T^{(T-1)k} \\
\end{bmatrix}
\begin{bmatrix}
1 \\ W_T^{(T-1)l} \\ W_T^{(T-2)l} \\ \vdots \\ W_T^l \\
\end{bmatrix} \\
&= \sum_{t=0}^{T-1} W_T^{kt} W_T^{l(T-t)} \\
&= \sum_{t=0}^{T-1} e^{-\frac{2\pi ikt}{T}}e^{-\frac{2\pi il(T-t)}{T}}= \sum_{t=0}^{T-1} e^{-\frac{2\pi i(k-l)t}{T}}\\
&= \begin{cases}
T, & k=l \\
0, & k \neq l \\
\end{cases}
\end{aligned}
$$

å› æ­¤ï¼Œ$W^{-1}$å¯ä»¥è¡¨ç¤ºä¸ºï¼š

$$
\frac{1}{T}\begin{bmatrix}
1 & 1 & 1 & \cdots & 1 \\
1 & W_T^{T-1} & W_T^{2(T-1)} & \cdots & W_T^{(T-1)(T-1)} \\
1 & W_T^{T-2} & W_T^{2(T-2)} & \cdots & W_T^{(T-2)(T-1)} \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
1 & W_T^1 & W_T^2 & \cdots & W_T^{T-1} \\
\end{bmatrix}
$$

æ­¤å¤–æ³¨æ„åˆ°ï¼š

$$
\begin{aligned}
\overline{W_T^k} &=\overline{e^{-\frac{2\pi ik}{T}}} = \cos\frac{2k\pi}{T} - i\sin \frac{2k\pi}{T} \\
&= \cos\left(2\pi-\frac{2k\pi}{T}\right) + i\sin\left(2\pi-\frac{2k\pi}{T}\right) \\
&= e^{-i(2\pi-\frac{2k\pi}{T})}= e^{-\frac{2\pi i(T-k)}{T}} \\
&= W_T^{T-k}
\end{aligned}
$$

å› æ­¤ï¼Œ$W^{-1}$è¿›ä¸€æ­¥åŒ–ç®€ä¸ºï¼š

$$
\frac{1}{T}\begin{bmatrix}
1 & 1 & 1 & \cdots & 1 \\
1 & \overline{W_T^1} & \overline{W_T^2} & \cdots & \overline{W_T^{T-1}} \\
1 & \overline{W_T^2} & \overline{W_T^4} & \cdots & \overline{W_T^{2(T-1)}} \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
1 & \overline{W_T^{T-1}} & \overline{W_T^{2(T-1)}} & \cdots & \overline{W_T^{(T-1)(T-1)}} \\
\end{bmatrix}
$$

æ³¨æ„åˆ°$W^{-1}$å’Œ$W$çš„åŒºåˆ«æ˜¯å°†ç³»æ•°$W_T^k$å–å…±è½­å¤æ•°ï¼Œå¹¶é™¤ä»¥$T$ã€‚å› æ­¤å®ç°**iFFT**ï¼Œåªéœ€è¦åœ¨**FFT**çš„åˆ†æ²»è¿‡ç¨‹ä¸­ä¹˜ä¸Šçš„ç³»æ•°å˜ä¸ºå…¶å…±è½­å¤æ•°ï¼Œåˆ†æ²»å®Œçš„æ¯ä¸€é¡¹é™¤ä»¥$T$å³å¯ã€‚

### âšª Bailey's FFTç®—æ³•

**Bailey's FFT**ä¹Ÿç§°ä¸º**4-step FFT**ï¼Œæ˜¯ä¸€ç§ç”¨äºè®¡ç®—**FFT**çš„é«˜æ€§èƒ½ç®—æ³•ã€‚è¯¥ç®—æ³•å°†æ ·æœ¬è§†ä¸ºäºŒç»´çŸ©é˜µï¼Œå¯¹çŸ©é˜µçš„åˆ—å’Œè¡Œæ‰§è¡Œç®€çŸ­çš„ **FFT** è¿ç®—ï¼Œå¹¶åœ¨è¿ç®—ä¹‹é—´ä¹˜ä»¥â€œæ—‹è½¬å› å­â€è¿›è¡Œæ ¡æ­£ã€‚

![](https://pic1.imgdb.cn/item/6804ba1d58cb8da5c8b91dd3.png)

ä¸Šè¿°åˆ†è§£è¡¨æ˜ï¼Œä¸€ä¸ª**DFT**çŸ©é˜µå¯ä»¥åˆ†è§£æˆå¤šä¸ªçŸ©é˜µçš„ä¹˜ç§¯ã€‚å¯¹äºä¸€ä¸ªé•¿åº¦ä¸º $N = N_1 \times N_2$ çš„åºåˆ—ï¼Œ**Bailey's FFT**æŠŠ**DFT**çŸ©é˜µ$F_N$åˆ†è§£ä¸ºï¼š

$$
F_N = P (I_{N_2} \otimes F_{N_1}) D P^{-1} (I_{N_1} \otimes F_{N_2}) P
$$

å…¶ä¸­$P$ æ˜¯ç½®æ¢çŸ©é˜µï¼›$D$ æ˜¯åŒ…å« **Twiddle** å› å­çš„å¯¹è§’çŸ©é˜µï¼›$F_{N_1}$ å’Œ $F_{N_2}$ æ˜¯è¾ƒå°çš„ **FFT** çŸ©é˜µã€‚

# 3. ä½¿ç”¨FFTåŠ é€Ÿæ·±åº¦å­¦ä¹ ä¸­çš„å·ç§¯è¿ç®—

## ï¼ˆ1ï¼‰å·ç§¯åœ¨æ—¶åŸŸå’Œé¢‘åŸŸè®¡ç®—çš„å¤æ‚åº¦

ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º$N$çš„åºåˆ—æ•°æ®$x[n]$ï¼Œä½¿ç”¨ä¸€ä¸ªå¤§å°ä¸º$K$çš„å·ç§¯æ ¸$h[k]$å¤„ç†è¯¥æ•°æ®ï¼›ä¸‹é¢åˆ†æå…¶åœ¨æ—¶åŸŸè¿ç®—å’Œé¢‘åŸŸè¿ç®—çš„å¤æ‚åº¦ï¼ˆä¸»è¦è€ƒè™‘ä¹˜æ³•ï¼‰ã€‚

### âšª æ—¶åŸŸå·ç§¯çš„å¤æ‚åº¦

åœ¨æ—¶åŸŸä¸­ï¼Œç›´æ¥è®¡ç®—å·ç§¯çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

$$
y[n] = \sum_{k=0}^{K-1} h[k] \cdot x[n - k]
$$

ä¸ºäº†è®¡ç®—å®Œæ•´çš„å·ç§¯ï¼Œéœ€è¦å¯¹è¾“å…¥åºåˆ—ä¸¤ç«¯å„è¿›è¡Œé•¿åº¦$K-1$çš„å¡«å……ã€‚æ­¤æ—¶è¾“å‡ºåºåˆ—çš„é•¿åº¦ä¸º$N + K - 1$ã€‚è®¡ç®—æ¯ä¸ªè¾“å‡ºç‚¹éœ€è¦è¿›è¡Œ$K$æ¬¡ä¹˜æ³•å’Œk-1æ¬¡åŠ æ³•ã€‚å› æ­¤è®¡ç®—å¤æ‚åº¦ä¸ºï¼š

$$
O((N + K - 1) \times K)
$$

### âšª é¢‘åŸŸå·ç§¯çš„å¤æ‚åº¦

åœ¨é¢‘åŸŸä¸­ï¼Œè®¡ç®—å·ç§¯çš„ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š

1. **é›¶å¡«å……**ï¼šä¸ºäº†é¿å…å¾ªç¯å·ç§¯çš„å½±å“ï¼Œéœ€è¦å°†åºåˆ—å’Œå·ç§¯æ ¸éƒ½è¡¥é›¶åˆ°è‡³å°‘ $M\geq N + K - 1$ çš„é•¿åº¦ï¼›
2. **FFTè®¡ç®—**ï¼šå¯¹é›¶å¡«å……åçš„è¾“å…¥åºåˆ—è¿›è¡Œ**FFT**ï¼š$O(2M \log_2 M)$ï¼›å¯¹é›¶å¡«å……åçš„å·ç§¯æ ¸è¿›è¡ŒFFTï¼š$O(2M \log_2 M)$ï¼›
3. **é¢‘åŸŸä¹˜æ³•**ï¼šåœ¨é¢‘åŸŸä¸­éœ€è¦è¿›è¡Œ$M$æ¬¡å¤æ•°ä¹˜æ³•ï¼Œå¯¹åº”$4M$æ¬¡å®æ•°ä¹˜æ³•ï¼›
4. **IFFTè®¡ç®—**ï¼šå¯¹ä¹˜ç§¯ç»“æœè¿›è¡Œ**iFFT**ï¼š$O(2M \log_2 M)$

å› æ­¤ï¼Œé¢‘åŸŸå·ç§¯çš„æ€»è®¡ç®—å¤æ‚åº¦ä¸ºï¼š

$$
\begin{aligned}
&O(6M \log_2 M +4M) \\
\approx &O(6(N + K - 1) \log_2 (N + K - 1) +4(N + K - 1)) \\
\end{aligned}
$$

### âšª å¤æ‚åº¦æ¯”è¾ƒ

- **æ—¶åŸŸå·ç§¯**ï¼š$O((N + K - 1) \times K)$
- **é¢‘åŸŸå·ç§¯**ï¼š$O(6(N + K - 1) \log_2 (N + K - 1) +4(N + K - 1))$

å½“$K \ll N$æ—¶ï¼Œæ—¶åŸŸå·ç§¯å¤æ‚åº¦$\approx O(N)$å°äºé¢‘åŸŸå·ç§¯å¤æ‚åº¦$\approx O(N \log_2 N)$ï¼Œæ—¶åŸŸå·ç§¯æ›´é«˜æ•ˆã€‚å½“$K \approx N$æ—¶ï¼Œæ—¶åŸŸå·ç§¯å¤æ‚åº¦$\approx O(N^2)$å¤§äºæ—¶åŸŸå·ç§¯å¤æ‚åº¦$\approx O(N \log_2 N)$ï¼Œé¢‘åŸŸå·ç§¯æ›´é«˜æ•ˆã€‚

ä¸ºäº†æ‰¾åˆ°æ—¶åŸŸå’Œé¢‘åŸŸè®¡ç®—å¤æ‚åº¦ç›¸å½“çš„ä¸´ç•Œ$K$ï¼Œå¯ä»¥è®¾ï¼š

$$
(N + K - 1) \times K = 6(N + K - 1) \log_2 (N + K - 1) +4(N + K - 1) \\
\downarrow \\
K = 6 \log_2 (N + K - 1) + 4 
$$

åˆ—å‡ºä¸€äº›$K$å’Œ$N$çš„å¯¹åº”å…³ç³»ï¼š

| $N$ | 64 | 128 | 256 | 512 | 1024 | 2048 |
| --- | --- | --- | --- | --- | --- | --- |
| $K$ | 44 | 49 | 54 | 59 | 65 | 70 |

æ³¨æ„åˆ°å½“å·ç§¯æ ¸è¾ƒå¤§æ—¶ï¼Œé¢‘åŸŸå·ç§¯çš„å¤æ‚åº¦ä¼˜åŠ¿ä¼šè¶Šæ¥è¶Šæ˜æ˜¾ã€‚

## ï¼ˆ2ï¼‰é¢‘åŸŸå·ç§¯çš„PyTorchå®ç°

```python
import torch

def fftconv(u, k):
    """
    A convolution through the fourier domain (from the Convolution Theorem)
    """
    seqlen = u.shape[-1]
    fft_size = 2 * seqlen

    k_f = torch.fft.rfft(k, n=fft_size) / fft_size
    u_f = torch.fft.rfft(u.to(dtype=k.dtype), n=fft_size)

    if len(u.shape) > 3: k_f = k_f.unsqueeze(1)
    y = torch.fft.irfft(u_f * k_f, n=fft_size, norm='forward')[..., :seqlen]

    return y.to(dtype=u.dtype)
```

### âšª è®¨è®ºï¼šå·ç§¯çš„å› æœæ€§

å·ç§¯æ“ä½œå…·æœ‰**å› æœæ€§(causal)**ã€‚å› æœæ€§æ˜¯æŒ‡è¾“å‡ºä¿¡å·åªä¾èµ–äºå½“å‰åŠä¹‹å‰çš„è¾“å…¥ä¿¡å·ï¼Œè€Œä¸ä¾èµ–äºæœªæ¥çš„ä¿¡å·ã€‚å› æœæ€§å¯ä»¥é¿å…æœªæ¥ä¿¡æ¯æ³„æ¼åˆ°å½“å‰æ—¶åˆ»ï¼Œä»è€Œä¿è¯ä¿¡å·çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

ä¸‹é¢ç”¨å›¾ä¾‹è¿›è¡Œè¯´æ˜ã€‚å‡è®¾è¾“å…¥ä¿¡å·$u$å’Œå·ç§¯æ ¸ä¸º$k$å…·æœ‰ç›¸åŒçš„é•¿åº¦$N$ï¼ŒåŒæ—¶å¡«å……è‡³$2N$ã€‚åœ¨è®¡ç®—å·ç§¯æ—¶ï¼Œå¯¹äºåºåˆ—çš„å½“å‰è¾“å…¥ä½ç½®ï¼Œä»…æœ‰æœ€å¤šå‰$N$ä¸ªè¾“å…¥ä¿¡å·å¯¹è¾“å‡ºæœ‰è´¡çŒ®ã€‚

![](https://pic1.imgdb.cn/item/6819ebdf58cb8da5c8e06ee6.png)

æœ‰æ—¶éœ€è¦æ‰“ç ´å·ç§¯çš„å› æœæ€§ï¼Œæ¯”å¦‚å¸Œæœ›å®ç°ç±»ä¼¼äºè‡ªæ³¨æ„åŠ›æœºåˆ¶çš„å…¨å±€ä¸Šä¸‹æ–‡æå–ã€‚ä¸€ç§ç®€å•çš„è§£å†³æ–¹å¼æ˜¯å¯¹å·ç§¯æ ¸è¿›è¡Œé‡å¤å¡«å……ï¼Œä¿è¯åœ¨å·ç§¯è¿ç®—æ—¶è‡³å°‘æœ‰$N$ä¸ªä½ç½®ä½¿å¾—è¾“å…¥åºåˆ—çš„æ‰€æœ‰æœ‰æ•ˆå…ƒç´ å‡å‚ä¸è¿ç®—ã€‚è¾“å‡ºç»“æœå–è¿™éƒ¨åˆ†ä½ç½®å³å¯ã€‚

![](https://pic1.imgdb.cn/item/6819ec2058cb8da5c8e06ef5.png)

```python
import torch

def fftconv(u, k):
    """
    A convolution through the fourier domain (from the Convolution Theorem)
    """
    seqlen = u.shape[-1]
    kernellen = k.shape[-1]
    fft_size = 2 * seqlen

    k_f = torch.fft.rfft(k, n=fft_size) / fft_size
    u_f = torch.fft.rfft(u.to(dtype=k.dtype), n=fft_size)

    if len(u.shape) > 3:
        k_f = k_f.unsqueeze(1)
    y = torch.fft.irfft(u_f * k_f, n=fft_size, norm="forward")

    y = y[..., kernellen // 2 : seqlen + kernellen // 2]
    return y.to(dtype=u.dtype)
```

## ï¼ˆ3ï¼‰æ·±åº¦å­¦ä¹ ä¸­çš„ä¾‹å­

